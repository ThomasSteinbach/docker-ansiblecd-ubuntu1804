image: docker:latest

stages:
  - lint
  - build
  - test

variables:
  BUILD_IMAGE: "${CI_PROJECT_PATH}:${CI_COMMIT_REF_NAME}"

lint:
  stage: lint
  script: docker run --rm -i hadolint/hadolint hadolint
            --ignore DL3008
            --ignore SC2016
            - < Dockerfile
build:
  stage: build
  script: docker build --pull -t "${BUILD_IMAGE}" .

test:
  stage: test
  image: "${BUILD_IMAGE}"
  script: ansible-playbook test/site.yml
